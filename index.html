<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta charset="UTF-8">

		<title>SAPUI5 Barcode Scanner</title>

<!-- 		<script id="sap-ui-bootstrap"
			src="https://openui5.hana.ondemand.com/resources/sap-ui-core.js"
			data-sap-ui-libs="sap.m"
			data-sap-ui-theme="sap_belize"
			data-sap-ui-compatVersion="edge"
			data-sap-ui-xx-bindingSyntax="complex"
			data-sap-ui-resourceroots='{"barcodeScanner": ""}'>
		</script> -->
	<script src="volume-meter.js"></script>
		<script type="text/javascript">
			
			// var oModel = new JSONModel(Device);
			// oModel.setDefaultBindingMode("OneWay");
			
			// Disable the scan barcode button by default
			// oModel.setProperty("/barcodeScanEnabled",false);
			if(navigator && navigator.mediaDevices && navigator.mediaDevices.getUserMedia){
				navigator.mediaDevices.getUserMedia({ audio: true, video: true }).then(function(stream){
					console.log('dsfl')
					audioContext = new AudioContext();
					analyser = audioContext.createAnalyser();
					microphone = audioContext.createMediaStreamSource(stream);
					javascriptNode = audioContext.createScriptProcessor(2048, 1, 1);

					analyser.smoothingTimeConstant = 0.8;
					analyser.fftSize = 1024;

					microphone.connect(analyser);
					analyser.connect(javascriptNode);
					javascriptNode.connect(audioContext.destination);
					javascriptNode.onaudioprocess = function() {
					  var array = new Uint8Array(analyser.frequencyBinCount);
					  analyser.getByteFrequencyData(array);
					  var values = 0;

					  var length = array.length;
					  for (var i = 0; i < length; i++) {
					    values += (array[i]);
					  }

					  var average = values / length;

					console.log(Math.round(average));
					// colorPids(average);
					}
				})
				.catch(function(err) {
    /* handle the error */
				});
			}
			
			// return oModel;
		</script>

		<link rel="stylesheet" type="text/css" href="css/style.css">

		<!-- <script>
			sap.ui.getCore().attachInit(function() {
				new sap.m.Shell({
					app: new sap.ui.core.ComponentContainer({
						height  : "100%",
						name 	: "barcodeScanner"
					})
				}).placeAt("content");
			});
		</script> -->
	</head>

	<body class="sapUiBody" id="content">
	</body>

</html>